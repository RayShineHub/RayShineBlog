(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{437:function(t,i,s){},448:function(t,i,s){"use strict";s(437)},461:function(t,i,s){"use strict";s.r(i);var e=s(8),a=s.n(e);var r={components:{DropdownTransition:s(43).a},data:()=>({open:!1,time:0,loading:!0,isPC:!0,playHistory:!0,isPlaying:!1,musicList:[],currentMusic:{musicId:"",currentTime:0,maxTime:0,duration:0,volume:.3,name:"",artist:"",url:"",cover:"https://p2.music.126.net/3MaeDnsU61e96WlH5-hoaQ==/109951163195183343.jpg",timestemp:0,lrc:"",lrcList:[],sort:0,brList:[]},lineNo:1,linksWrapOffsetWidth:null,linksWrapMaxWidth:null,fixedHeight:0,pageYOffset:44,isFixed:!1,isVisible:!1}),computed:{playlistId(){return this.$themeConfig.NavPlayer.playlistId||""},autoPlay(){return this.$themeConfig.NavPlayer.autoPlay||!1},volumeStep(){return this.$themeConfig.NavPlayer.volumeStep||.1},defaultVolume(){return this.$themeConfig.NavPlayer.defaultVolume||.3},playType(){return this.$themeConfig.NavPlayer.playType||"listLoop"}},watch:{},mounted(){/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?this.isPC=!1:(this.isPC=!0,this.getMusicList(this.playlistId)),this.handleLinksWrapWidth(),window.addEventListener("resize",this.handleLinksWrapWidth,!1),window.addEventListener("scroll",this.throttle(this.handleScroll,500))},beforeDestroy(){window.removeEventListener("scroll",this.throttle(this.handleScroll,1e3))},methods:{handleLinksWrapWidth(){let t=this,i=document.querySelector(".nav-sub")&&document.querySelector(".nav-sub").offsetWidth||1872;document.documentElement.clientWidth<719?t.linksWrapMaxWidth=null:t.linksWrapOffsetWidth=document.querySelector(".links")&&document.querySelector(".links").offsetWidth||726,(null==t.linksWrapOffsetWidth||t.linksWrapOffsetWidth>i)&&setTimeout(()=>{this.handleLinksWrapWidth()},5e3)},handleScroll(){this.isFixed=window.pageYOffset>this.fixedHeight,this.throttle(this.handleVisible(),1e3)},handleVisible(){this.isVisible=window.pageYOffset<this.pageYOffset&&window.pageYOffset>0,this.pageYOffset=window.pageYOffset},throttle(t,i=200){let s=null,e=Date.now();return function(){const a=Date.now(),r=i-(a-e),n=arguments,c=this;clearTimeout(s),r<=0?(t.apply(c,n),e=Date.now()):s=setTimeout(t,r)}},getMusicList(t="144719593"){let i=this,s=0;a()({baseURL:i.$themeConfig.back.musicUrl,url:"/playlist/detail?id="+t,withCredentials:!0}).then((function(t){if(200===t.status&&200===t.data.code){let e=t.data.playlist.trackIds.filter(t=>t.id).map(t=>t.id).join(",");a()({baseURL:i.$themeConfig.back.musicUrl,url:"/song/detail?ids="+e,withCredentials:!0}).then((function(t){200===t.status&&200===t.data.code&&(i.musicList=t.data.songs.map(i=>{let e=t.data.privileges.filter(t=>t.id==i.id).map(t=>t.chargeInfoList.map(t=>t.rate))[0];return{musicId:i.id,name:i.name||"",artist:i.ar[0].name||"",cover:i.al.picUrl||"",brList:e,sort:s++}}),i.$refs.audio.volume=i.defaultVolume,i.currentMusic.volume=i.$refs.audio.volume,i.getCurrentMusic("first"))}),(function(t){i.loading=!1,i.currentMusic.artist=t.response.data.message,i.currentMusic.currentTime=0,console.log(t)}))}}),(function(t){i.loading=!1,i.currentMusic.artist="歌单获取失败",i.currentMusic.currentTime=0,console.log(t)}))},getCurrentMusic(t="first",i={}){if(this.currentMusic.lrc="","random"==this.playType&&"change"!==t){let t=this.musicList.filter(t=>t.musicId!=this.currentMusic.musicId);this.currentMusic=Object.assign({},this.currentMusic,t[Math.floor(Math.random()*t.length)])}else if("first"===t)this.currentMusic=Object.assign({},this.currentMusic,this.musicList[0]);else if("change"===t)this.currentMusic=Object.assign({},this.currentMusic,i);else{let i="prev"==t?this.currentMusic.sort--:this.currentMusic.sort++;"next"===t&&i>this.musicList.length-1?i=0:"prev"===t&&i<0&&(i=this.musicList.length-1),this.currentMusic=Object.assign({},this.currentMusic,this.musicList[i])}this.getMusic(this.currentMusic.musicId,this.currentMusic.brList[this.currentMusic.brList.length-1],t)},getMusic(t="1868943615",i=128e3,s){let e=this;""!==t&&(e.loading=!0,a()({baseURL:e.$themeConfig.back.musicUrl,url:"/check/music?id="+t+"&br="+i,withCredentials:!0}).then((function(r){200===r.status&&r.data.success&&a()({baseURL:e.$themeConfig.back.musicUrl,url:"/song/url?id="+t+"&br="+i,withCredentials:!0}).then((function(i){200===i.status&&(e.loading=!1,e.pause(),e.currentMusic.url=i.data.data[0].url.match("^http://")?i.data.data[0].url.replace("http://","https://"):i.data.data[0].url,e.lineNo=1,("first"!=s||"first"==s&&e.autoPlay)&&e.playHistory&&setTimeout(()=>{e.$refs.audio.play()},2e3)),e.getMusicLrc(t)}),(function(t){e.loading=!1,console.log(t)}))}),(function(t){e.loading=!1,e.currentMusic.artist=t.response.data.message,e.currentMusic.url="",e.currentMusic.name="",e.currentMusic.currentTime=0,"change"!=s&&setTimeout(()=>{e.next()},2e3),console.log(t)})))},getMusicLrc(t="1868943615"){let i=this;t&&a()({baseURL:i.$themeConfig.back.musicUrl,url:"/lyric?id="+t,withCredentials:!0}).then((function(t){if(200===t.status){let s=t.data.lrc.lyric;i.currentMusic.lrcList=s.split("\n").map(t=>{let i=t.substring(t.indexOf("[")+1,t.indexOf("]")+0).split(":");return{timestemp:parseInt(Math.floor(60*i[0])+Math.floor(i[1])),str:t.substring(t.indexOf("]")+1)}}).filter(t=>t.str)}}),(function(t){console.log(t)}))},transformLrc(){let t=this.time,i=this,s=i.currentMusic&&i.currentMusic.lrcList.filter(i=>i.timestemp==parseInt(t)).map(t=>t.str).join(",");s&&i.currentMusic.lrc!=s&&(i.currentMusic.lrc=s,i.lineNo=i.lineNo+i.currentMusic.lrc.split(",").length),i.$refs.lyric.scrollTop=45.08*i.lineNo-85},onPlay(){return this.isPlaying?this.$refs.audio.pause():this.$refs.audio.play()},play(){this.playHistory=!1,this.isPlaying=!0},pause(){this.playHistory=!0,this.isPlaying=!1},next(t){this.$refs.audio.pause(),this.getCurrentMusic("next")},prev(t){this.$refs.audio.pause(),this.getCurrentMusic("prev")},transTime(t){var i=parseInt(t),s=parseInt(i/60),e=i%60+"";return 0===s?s="00":s<10&&(s="0"+s),1===e.length&&(e="0"+e),s+":"+e},onTimeupdate(t){this.currentMusic.currentTime=this.transTime(this.currentMusic.duration-t.target.currentTime),this.currentMusic.timestemp=parseInt(Math.floor(100*t.target.currentTime)/100),this.time=t.target.currentTime,this.transformLrc()},onLoadedmetadata(t){this.currentMusic.duration=t.target.duration,this.currentMusic.maxTime=this.transTime(t.target.duration),this.currentMusic.currentTime=this.currentMusic.maxTime},onEnded(t){this.next()},onVolume(t){let i=parseInt(10*this.$refs.audio.volume),s=10*this.volumeStep;this.$refs.audio.volume="jian"===t?i-s<=0?0:(parseInt(10*this.$refs.audio.volume)-s)/10:i+s>=10?1:(parseInt(10*this.$refs.audio.volume)+s)/10,this.currentMusic.volume=this.$refs.audio.volume},immerse(t){this.open=!this.open}}},n=(s(448),s(1)),c=Object(n.a)(r,(function(){var t=this,i=t._self._c;return t.isPC&&null!=t.linksWrapOffsetWidth?i("div",{staticClass:"nav-music",class:{pagefull:(t.$frontmatter.layout||t.$themeConfig.fullscreen&&t.$frontmatter.isFull||t.$frontmatter.home)&&!t.isFixed,fixed:t.isFixed,visible:t.isVisible&&!t.open},style:t.linksWrapOffsetWidth?{right:t.linksWrapOffsetWidth+"px"}:{}},[i("div",{staticClass:"dropdown-wrapper"},[i("a",{staticClass:"img-box"},[i("img",{staticClass:"avatar",class:{playing:t.isPlaying},attrs:{src:t.currentMusic?t.currentMusic.cover:""},on:{click:t.immerse}})]),t._v(" "),i("DropdownTransition",[i("ul",{staticClass:"music-dropdown",staticStyle:{"margin-top":"-.3rem"}},t._l(t.musicList,(function(s,e){return i("li",{key:s.link||e,staticClass:"music-dropdown-item"},[i("div",{staticClass:"music-info",on:{click:function(i){return t.getCurrentMusic("change",s)}}},[i("img",{staticClass:"avatar",attrs:{src:s?s.cover:""}}),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"title-name"},[i("span",[t._v("\n                  "+t._s(s.name||"")+"  \n                ")])]),t._v(" "),i("div",{staticClass:"title-name-sub"},[i("span",[t._v("\n                  "+t._s(s.artist||"")+"\n                ")])])])])])})),0)])],1),t._v(" "),i("div",{staticClass:"actions"},[i("div",{staticClass:"title"},[0==t.currentMusic.currentTime||t.loading?t._e():i("div",{staticClass:"time"},[i("span",{staticStyle:{"margin-right":"0.1rem"}},[t._v("\n          "+t._s(0==t.currentMusic.currentTime?"":t.currentMusic.currentTime)+"\n        ")])]),t._v(" "),t.loading?i("div",{staticClass:"loading"},[i("span"),t._v(" "),i("span"),t._v(" "),i("span"),t._v(" "),i("span"),t._v(" "),i("span")]):t._e(),t._v(" "),i("div",{staticClass:"title-name"},[i("span",[t._v("\n          "+t._s(t.isPlaying?t.currentMusic.lrc:(t.currentMusic.artist||"")+(t.currentMusic.name?" - ":"")+(t.currentMusic.name||""))+"  \n        ")])])]),t._v(" "),i("div",{staticClass:"action-bar"},[i("i",{staticClass:"iconfont rays-prev-face",on:{click:t.prev}}),t._v(" "),t.isPlaying?t._e():i("i",{staticClass:"iconfont rays-play",on:{click:t.onPlay}}),t._v(" "),t.isPlaying?i("i",{staticClass:"iconfont rays-pause",on:{click:t.onPlay}}):t._e(),t._v(" "),i("i",{staticClass:"iconfont rays-next-face",on:{click:t.next}}),t._v(" "),t.currentMusic.volume<=0?i("i",{staticClass:"iconfont rays-mute",staticStyle:{"margin-left":"1rem"}}):t._e(),t._v(" "),t.currentMusic.volume>0?i("i",{staticClass:"iconfont rays-volume-reduce",staticStyle:{"margin-left":"1rem"},on:{click:function(i){return t.onVolume("jian")}}}):t._e(),t._v(" "),i("span",{staticClass:"volume"},[t._v(t._s(parseInt(10*t.currentMusic.volume)))]),t._v(" "),i("i",{staticClass:"iconfont rays-volume-add",on:{click:function(i){return t.onVolume("jia")}}})])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.open,expression:"open"}],staticClass:"immerse-wapper"},[i("div",{staticClass:"immerse-action"},[i("span",{staticClass:"immerse-close",on:{click:t.immerse}})]),t._v(" "),i("div",{staticClass:"immerse-main"},[i("div",{staticClass:"immerse-avtar"},[i("img",{staticClass:"avatar",class:{playing:t.isPlaying},staticStyle:{width:"20rem",height:"20rem","border-radius":"500px"},attrs:{src:t.currentMusic?t.currentMusic.cover:""}})]),t._v(" "),i("div",{staticClass:"immerse-cover"},[i("div",{staticClass:"immerse-title"},[i("span",[t._v("\n            "+t._s(t.currentMusic.name||"")+"  \n          ")])]),t._v(" "),i("ul",{ref:"lyric",staticClass:"immerse-lrc"},[i("div",{staticStyle:{margin:"30% 0"}},t._l(t.currentMusic.lrcList,(function(s,e){return s.str?i("li",{key:e,staticClass:"lrc",class:t.isPlaying&&s.timestemp<=t.currentMusic.timestemp&&e!=t.currentMusic.lrcList.length-1&&t.currentMusic.timestemp<parseInt(t.currentMusic.lrcList[e+1].timestemp)?"active":""},[t._v(t._s(s.str))]):t._e()})),0)])]),t._v(" "),i("div",{staticClass:"immerse-musicList"},[i("div",[t._v("\n          歌单列表\n        ")]),t._v(" "),i("div",[i("ul",{staticClass:"immerse-musicList-wapper"},t._l(t.musicList,(function(s,e){return i("li",{key:s.link||e,staticClass:"music-dropdown-item"},[i("div",{staticClass:"music-info",on:{click:function(i){return t.getCurrentMusic("change",s)}}},[i("img",{staticClass:"avatar",attrs:{src:s?s.cover:""}}),t._v(" "),i("div",{staticClass:"detail"},[i("div",{staticClass:"title-name"},[i("span",[t._v("\n                      "+t._s(s.name||"")+"  \n                    ")])]),t._v(" "),i("div",{staticClass:"title-name-sub"},[i("span",[t._v("\n                      "+t._s(s.artist||"")+"\n                    ")])])])])])})),0)])])]),t._v(" "),i("hr"),t._v(" "),i("div",{staticClass:"immerse-footer"},[i("div",{staticClass:"action-bar"},[i("i",{staticClass:"iconfont rays-prev-face",on:{click:t.prev}}),t._v(" "),t.isPlaying?t._e():i("i",{staticClass:"iconfont rays-play",on:{click:t.onPlay}}),t._v(" "),t.isPlaying?i("i",{staticClass:"iconfont rays-pause",on:{click:t.onPlay}}):t._e(),t._v(" "),i("i",{staticClass:"iconfont rays-next-face",on:{click:t.next}}),t._v(" "),t.currentMusic.volume<=0?i("i",{staticClass:"iconfont rays-mute",staticStyle:{"margin-left":"1rem"}}):t._e(),t._v(" "),t.currentMusic.volume>0?i("i",{staticClass:"iconfont rays-volume-reduce",staticStyle:{"margin-left":"1rem"},on:{click:function(i){return t.onVolume("jian")}}}):t._e(),t._v(" "),i("span",{staticClass:"volume"},[t._v(t._s(parseInt(10*t.currentMusic.volume)))]),t._v(" "),i("i",{staticClass:"iconfont rays-volume-add",on:{click:function(i){return t.onVolume("jia")}}})])])]),t._v(" "),i("audio",{ref:"audio",attrs:{autoplay:!1,src:t.currentMusic.url,volume:.3},on:{play:t.play,pause:t.pause,loadedmetadata:t.onLoadedmetadata,timeupdate:t.onTimeupdate,ended:t.onEnded}})]):t._e()}),[],!1,null,"9f65e7e2",null);i.default=c.exports}}]);